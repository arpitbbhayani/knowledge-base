so do hyper local companies like uber Ola swiggy gojek zomato Etc share our phone numbers with the delivery agents or theirs with us if they do then that would be a massive breach of privacy hence they have a system in place that instead of sharing the actual phone numbers they share a masked version of it in this video we talk about how these hyper local companies work with Telecom operators to generate virtual phone numbers and keep our privacy in debt but before we move forward I'd like to talk to you about a course on system design that I've been running for over a year and a half now the course is a code based course which means I won't be rambling a solution and it will not be a monologue at all instead a small focused group of 50 to 60 Engineers will be brainstorming the systems and designing it together this way we build a very solid system and learn from each other's experiences the course is enrolled by 800 plus engineer spanning 12 codes and 12 countries ingenious from companies like Google Microsoft GitHub slack Facebook Tesla Yelp Flipkart dream11 and many many many more have taken this course and have some wonderful things to say the course is focused on Building Systems the way they are built in the real world we will be focusing heavily on building the right intuition so that you are ready to build any and every system out there we will be discussing the trade-offs of every single decision we make just like how you do in your team we cover topics ranging from Real Time text communication for slack to designing our own toilet balance live text commentary to doing impressions counting at scale in all we would be covering roughly 28 systems and the detailed curriculum split week by week can be found in the course page linked in the description down below so if you are looking to learn system design from the first principles you will love this course I have two offerings for you the first one is the live cohort based course and the second one is the recorded offering the Live code base course happens once every two months and will go on for eight weeks while the recorded course contains the recordings from one of the past cohorts as it's if you are in a hurry and want to learn and want to binge learn system design I would recommend going you for the recorded one otherwise the Live code is where you can participate and discuss the systems and its design life with me and the entire cohort the decision is totally up to you the course details prerequisites testimonials can be found on the course page arpitbani dot me slash masterclass I repeat ad with many dot me slash masterclass and I would highly recommend you to check that out I've also put the link of this course page in the description down below and I'm looking forward to see you in my next cohort so phone numbers are extremely critical because it is a personally identifiable information so for example just imagine if a phone number gets leaked in public you will be added to random groups people would be sending you random calls or people would be sending you random messages things could go wrong worse people can do social engineering on you and can hack your accounts it would be so so so easy for you because they can exactly pinpoint who you are so which is where the companies with whom you share your contact number maybe during login maybe maybe during the transaction or basically getting an order delivered it's their responsibility to keep them secured right which is where the idea of virtual phone numbers kick in they are extremely temporary very limited to a transaction so now let's define the problem statement the problem segment is pretty simple we have like we are gojek and by the way this entire design is taken from gojex engineering block which I've Linked In the description down below do give it a read so let's say we are gojek and we have a customer a and a delivery agency customer a phone number is let's say one two three four where Delivery Agent phone number is 6789 so what do we want we want a to not get D's actual number we want D to not get A's actual number but still they both should be able to call each other such a fancy situation to be in right so this is where virtual phone numbers kick in so here Telecom providers like Airtel jio xotel twilio like there may be the actual telecom companies or maybe an intermediate company who have a partnership with them right but someone to make our life simple issues virtual phone numbers right so exerted value are the biggest providers of that they have extensive documentation go read them right so Telecom provider like Airtel jio exotic twilio provide virtual numbers they look very similar to actual phone number but they are functional right and they are very transactional so now what happens is let's say we call a service like VN settings which is your virtual number service so these vendors they have a list of phone numbers they already have a list of virtual phone numbers which they periodically send to us or rather we request them and they send to us it depends on the API contract that you have with them but the idea is vendors like exerted failure they have a list of phone numbers you make a call to them and they would share a bunch of phone numbers with you right which are virtual which you can assign it at your they are your private phone numbers right so you make a call you get it and you put it in your database so you keep them handy for your transaction to work because you on the fly if you make that call to them and they don't have a number then would you not do like like basically would you not move forward no you would still want to be functional which is what happens is when does keyboard list of Handy you make a call they share it with you you keep a lot of virtual numbers handy with you for in order for you to assign it to your orders right so this is what the first step looks like so now does every user get a virtual number now if I if we ask this particular question does every user get a virtual number now imagine if there is a one-to-one mapping of it let's say hey I am up with my actual number is one two three and I'm assigned a number let's say a it is actually a number but I'm just representing it a so that you can visually distinguish it so let's say I am my I am a my actual number is one two three and my virtual number is a if I keep it static if I keep it static what would happen it is very easy for anyone to socialize because there is no problem at all right because I used to give them call to an actual number but now if virtual number also Remains the Same you can give a call to Virtual number also right so which means that you cannot have a one-to-one mapping always like a permanent one-to-one mapping between a user's actual number and a virtual number right so which means that we have to make it temporarily allocated and then after some time it should be assigned to someone else right but it cannot remain same for the same user like you cannot just have one number for one user always like till eternity right and second reason is if let's say there is a customer that comes that came onto gojek and it just assigned or he or she just made one order and never came back onto the platform right never now if you just assign one number for each user forever then if you have a million users you need a Million numbers even though most of them are not even used quite possible so which is where what do we need like the constraints that we play with is we need virtual number assignment should be number one on demand which means when I request it I should be able to get it second it they should be temporarily for a transaction or order right once that is done virtual number should be unassigned so that it is assigned to someone else this way we make the best use of our available resources while being cost effective at the same time okay now let's take a look how virtual numbers are assigned so virtual numbers are assigned to all the involved parties in a transaction so let's say if I placed an order an online order so virtual number will be assigned to me and the driver right so here and so it's specific to a transaction now what does this mean this means that if and obviously we have seen in hyper local delivery that a Delivery Agent a uh or rather a a Delivery Agent can be delivering multiple orders right so for each transaction The Delivery Agent will be assigned a new virtual number so for example if let's say Delivery Agent is delivering two orders right so one with a other with b and The Delivery Agent is D so for a eight with derivation D for a particular transaction D will be assigned a virtual number and for B and D it will be assigned another virtual number so if any of those numbers are called the call will go to that same Delivery Agent right so this is what is extremely important otherwise that same problem comes in that we just discussed right so now what do we do we have a bunch of virtual numbers stored in our database so when an order happens right we go to the database pick two numbers pick two virtual numbers from them and assign it to a transaction and rather assign it to the individual prop individual entities of our transaction individual parties of a transaction right so that is what we'll do but now how how does our Arc how does our architecture look like so it looks like something like this right so here what do we have so here we have our vendor like twilio xotel idle they have a bunch of numbers which they exchange with our VN service VN service stores it in the database right so now this is what is happening we have our users a B these are customers and these are Delivery Agent right all these three users phone number are stored in our authentication table or profile table right we have the actual phone number with us right when there is actual number is one two three B is actual number is seven at nine D's which is delivery agents actual number is four five six right so now what do we want we do not want a is one two three to be sent to D let's say d as a Delivery Agent is assigned order to be delivered for a as well and B as well right so we do not want one two three to be shared with d we do not want seven eight nine of B to be shared with d either or rather D's number with a and b right so no need to that happen so first of all we need to do virtual number assignment so how do we do that so when would we assign the number the number the virtual number will be assigned when the order is placed and the driver is alerted right so we have our order service right we have our order service when a user lets say A and B plays the order on the order service and that order service may like whenever a driver is assigned or something anytime the state changes an event would be sent to a Kafka right from there the consumers would read the driver assigned events and then at that time once we know that for this order this driver is assigned we talk to VN service and get two pair like sorry we get one pair of virtual numbers from the VNS database right so first of all hey give me two virtual numbers because I have two parties involved A and D I want to assign virtual number to both of them once we get the pair A and B now uh once we get virtual numbers for A and D which are AAA and DDD now what we do is we go to order service and update in it in the orders database because orders database is where ready for this order like this order is placed by a and assigned to driver d a is virtual number is AAA and D's virtual number is DDD right that would be stored in the orders table so that we can render it in the app right because in app when you see you need to see these numbers so that you can directly give him or her a call right so you need to share it so that would be part of your orders table right or orders database now how does this transaction look like right what would happen when a gives a call to the delivery agent right now what would happen so what does a have a has its own number which is one two three and it calls D Delivery Agent but a does not have these number a has what a has D's anonymized number or these virtual number which is DDD so a calls DDD now where would this call go this call would go to a telecom operator right so maybe through twilio through X Hotel bunch of apis to call like a lot of things could happen along that way but through that telecom operator like obviously there is a global repository where all of these things are updated then a calls DDD so one two three calls DDD now Telecom agent receives the request now what would it do it does not know whom to forward to they do not know the mapping it is an application use case you know that driver D is alerted to this order from a and now a is giving the call to D now Telecom operator do not know Telecom operator do not know who what to whom ddds are select to who to actual number because for Telecom operator it would give call to the actual number actual number of DDS 456 but who has that mapping we have that we as gojek have that mapping right so now what do we do Telecom operator receives that request it makes a call to rvn service and rvn service would do what validate we have to validate that if this transaction is even valid or not because otherwise you have the number you give a call then that's wrong right it has to be an active transaction against urm and that pairing should exist so what VN service would do VN service would validate the request and respond is virtual number and D is actual number two Telecom operator so now I'm going to tell you when you gave a call Telecom operator gets your virtual number and these actual number so the Telecom Twitter can actually I can only give a call to actual number so Telecom operator needs these actual number and a is virtual number you say why it needs is virtual number because because if when you get a call from someone you see their number right but now if Telecom operator do not know a is virtual number the number that it would display on the users when you get a call what would be the source number there is private number you do not want that to expose so which is where you share is virtual number which is would be used as a source number and these actual number so then Telecom connects with d on 456 these actual number and sets source as AAA so D on his or her phone sees a that he that it is receiving call from AAA the actual number is one two three right and this is how the bridge is set up between the user and The Delivery Agent without users or delivery agents number being shared with each other just ensuring the entire privacy of the transaction once the transaction is done order is delivered virtual numbers are set free so that they can be assigned to someone else now here an important step is this the validation step so that if I like then if I do not have that validation this particular validation step I can make a call to any virtual number then some other Delivery Agent would pick it or then some other customer would pick it so which is where this x this is this becomes an extremely important step if you are actually checking the sanity of the request that has come in that if a is making a call to a particular number is there a bridge between the two or not this is an extremely important step to ensure perfect privacy or just rather ephemeral privacy during the transaction right and yeah this is how the system is designed right now to dive deep into this matter what you should be doing is go through twilio's documentation on Virtual numbers right very seamless very easy to go through a documentation like that you understand the kind of apis the Expo so that if you are ever designing the system you would be in a much better shape to know to exactly know what kind of things they provide what kind of information you need to exchange how to establish that connection and whatnot right so twilos are just you are just a Google search away from finding it out virtual numbers placed twilio you will find a documentation go through it and understand it in much much much more depth so yeah that is it that is it for this one this entire thing is taken from gojex engineering blog brilliantly returned I've linked it in the description down below highly highly highly recommend you to check that out so yeah that is it for this one I'll see in the next one thanks [Music] [Music]